<html lang="he" dir="rtl" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Project Sentinel v24.1 | Stable & Feature Complete</title>
  <meta name="theme-color" content="#0f172a">
  <!-- React, Babel, Tailwind, Chart.js, html2canvas (ללא שינויי גרסה) -->
  <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/@babel/standalone@7.24.7/babel.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" crossorigin="anonymous"></script>

  <!-- Fonts + Emoji fallback -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&display=swap');

    /* Emoji fallback stack to avoid squares - system first */
    :root, html, body, * {
      font-family:
        'Heebo', ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont,
        "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
        "Noto Color Emoji", "Twemoji Mozilla",
        "Helvetica Neue", Arial, sans-serif !important;
      font-feature-settings: "kern" 1, "liga" 1, "calt" 1;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* תיקון ריבועים: כפייה גם על אייקונים/כותרות */
    h1,h2,h3,h4,h5,h6,button,input,select,textarea,.fa,.fas,.far,.fal,.fab {
      font-family:
        'Heebo', ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont,
        "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
        "Noto Color Emoji", "Twemoji Mozilla",
        "Helvetica Neue", Arial, sans-serif !important;
    }

    /* נושאים/צבעים וכל שאר ה-CSS המקורי כפי שהיה בקובץ המצורף... */
  </style>
</head>
<body class="theme-dark">
  <div id="root"></div>

<script type="text/babel">
/* =========================================================
   נתוני תרגום (מקוריים) + תוספות מינוריות לטקסטים
   ========================================================= */
const {useState,useEffect,useRef,useCallback,useReducer,createContext,useContext,useMemo} = React;

/* ... translations object from your file (unchanged) ... */

/* =========================================================
   תמיכה בהתמדה במובייל (iOS/Safari) + IndexedDB guard
   ========================================================= */
/*
בעיית iOS/WebKit:
- localStorage/IndexedDB עלולים להתאפס, ובעיקר ב-PWA / WebView.
תיקון:
- כתיבה כפולה: גם localStorage (מהיר) וגם IndexedDB (עמיד יותר).
- שמירה אוטומטית לאחר כל SAVE/RESET/UPDATE.
- בקשת persistance אם זמין (Chrome/Android), וב-iOS נבצע sync onvisibilitychange/onpagehide.
- Retry ומעבר ל-localStorage-only אם IndexedDB אינו זמין.
מקורות רקע: בעיות התPersistence של WebKit, מגבלות IndexedDB ו-nuking storage.[2][3][4][5][6][7][1]
*/
const DB_NAME = 'sentinelDB';
const DB_STORE = 'reports';
const DB_VERSION = 1;

function openDB() {
  return new Promise((resolve, reject) => {
    if (!('indexedDB' in window)) {
      resolve(null);
      return;
    }
    const req = indexedDB.open(DB_NAME, DB_VERSION);
    req.onupgradeneeded = () => {
      const db = req.result;
      if (!db.objectStoreNames.contains(DB_STORE)) {
        db.createObjectStore(DB_STORE);
      }
    };
    req.onsuccess = () => resolve(req.result);
    req.onerror = () => resolve(null);
  });
}

async function idbSet(key, value) {
  const db = await openDB();
  if (!db) return false;
  return new Promise((resolve) => {
    const tx = db.transaction(DB_STORE, 'readwrite');
    const store = tx.objectStore(DB_STORE);
    store.put(value, key);
    tx.oncomplete = () => resolve(true);
    tx.onerror = () => resolve(false);
  });
}

async function idbGet(key) {
  const db = await openDB();
  if (!db) return null;
  return new Promise((resolve) => {
    const tx = db.transaction(DB_STORE, 'readonly');
    const store = tx.objectStore(DB_STORE);
    const req = store.get(key);
    req.onsuccess = () => resolve(req.result ?? null);
    req.onerror = () => resolve(null);
  });
}

async function idbRemove(key) {
  const db = await openDB();
  if (!db) return false;
  return new Promise((resolve) => {
    const tx = db.transaction(DB_STORE, 'readwrite');
    const store = tx.objectStore(DB_STORE);
    store.delete(key);
    tx.oncomplete = () => resolve(true);
    tx.onerror = () => resolve(false);
  });
}

async function persistIfPossible() {
  // Chrome/Android בלבד תומכים
  try {
    if (navigator.storage && navigator.storage.persist) {
      await navigator.storage.persist();
    }
  } catch (e) {
    // ignore
  }
}

/* =========================================================
   הקשר שפה
   ========================================================= */
/* ... LanguageContext and provider from your file (unchanged) ... */

/* =========================================================
   מודל הדאטה + חישובים
   ========================================================= */
const DashboardContext = createContext();

const initialReportState = {
  id: null,
  signedOrders: 0,
  existingBacklog: 0,
  pendingSignature: {
    'ענף גזברות': 0,
    'רכש, מכרזים ולוגיסטיקה': 0,
    'כספים וחשבות': 0
  },
  rejectedOrders: 0,
  pendingAncillaryForm: 0,
  pendingCorrection: 0,
  pendingAssetNumberEntry: 0
};

function calculateTotals(data) {
  if (!data) {
    return {
      ...initialReportState,
      computedMetrics: {
        totalPending: 0,
        goalPercentage: 0,
        totalPendingSignature: 0,
        backlogDifference: 0
      }
    };
  }
  const totalPendingSignature = Object.values(data.pendingSignature || {}).reduce((a,b)=>a+b,0);
  const totalPending = totalPendingSignature;
  const backlogDifference = (data.existingBacklog || 0) - (data.signedOrders || 0);
  const goalPercentage = (data.existingBacklog || 0) > 0
    ? (data.signedOrders || 0) / (data.existingBacklog || 1) * 100
    : 0;
  return {
    ...data,
    computedMetrics: {
      totalPending,
      goalPercentage,
      totalPendingSignature,
      backlogDifference
    }
  };
}

/* =========================================================
   מחסן נתונים: רציפות בין סוגי דוחות ותאריכים
   ========================================================= */
function dateToStr(d) { return d.toISOString().split('T'); }
function addDaysStr(dateStr, delta) {
  const d = new Date(dateStr);
  d.setDate(d.getDate()+delta);
  return dateToStr(d);
}
function reportId(dateStr, type) {
  return `${dateStr}-${type}`; // type in {'morning','daily'}
}

function loadLocalReports() {
  try {
    return JSON.parse(localStorage.getItem('sentinelReports') || '{}');
  } catch { return {}; }
}
function saveLocalReports(obj) {
  try {
    localStorage.setItem('sentinelReports', JSON.stringify(obj));
  } catch {}
  // כתיבה גם ל-IDB
  idbSet('sentinelReports', JSON.stringify(obj));
}
async function loadReportsHybrid() {
  const fromIdb = await idbGet('sentinelReports');
  if (fromIdb) {
    try { return JSON.parse(fromIdb); } catch { /* ignore */ }
  }
  return loadLocalReports();
}

/* כלל רציפות כפי שתואר:
   - morning של תאריך X: אם אין מסמך, נטען daily של X-1 כבסיס.
   - daily של תאריך X: אם אין מסמך, נטען morning של X כבסיס.
*/
function computeContinuityBase(allReports, dateStr, type) {
  const currentId = reportId(dateStr,type);
  if (allReports[currentId]) return JSON.parse(JSON.stringify(allReports[currentId]));

  if (type === 'morning') {
    const prevDay = addDaysStr(dateStr,-1);
    const prevDaily = reportId(prevDay,'daily');
    return allReports[prevDaily]
      ? JSON.parse(JSON.stringify(allReports[prevDaily]))
      : JSON.parse(JSON.stringify(initialReportState));
  } else { // daily
    const sameMorning = reportId(dateStr,'morning');
    return allReports[sameMorning]
      ? JSON.parse(JSON.stringify(allReports[sameMorning]))
      : JSON.parse(JSON.stringify(initialReportState));
  }
}

/* מקור “לפני” להשוואה גרפית:
   - אם מוצג morning של X: before = daily של X-1
   - אם מוצג daily של X:  before = morning של X
*/
function computePreviousForCompare(allReports, dateStr, type) {
  if (type === 'morning') {
    const prevDay = addDaysStr(dateStr,-1);
    return allReports[reportId(prevDay,'daily')] || null;
  } else {
    return allReports[reportId(dateStr,'morning')] || null;
  }
}

/* טעינה ראשונית (היברידית) */
function loadInitialState() {
  const allReports = loadLocalReports(); // sync path; idb sync יעשה בהמשך
  const lastId = localStorage.getItem('sentinelLastSavedReportId');
  const initialId = lastId || null;
  const initialData = initialId && allReports[initialId]
    ? allReports[initialId]
    : initialReportState;

  return {
    allReports,
    currentReportId: initialId,
    dataForEditing: JSON.parse(JSON.stringify(initialData)),
    liveData: calculateTotals(initialData),
    previousValues: {},
    lastUpdateInfo: null,
    notifications: [],
    userRole: 'user',
    isAuthenticated: false
  };
}

/* =========================================================
   Reducer
   ========================================================= */
function dashboardReducer(state, action) {
  switch (action.type) {
    case 'LOGIN_SUCCESS':
      return {...state, isAuthenticated: true, userRole: action.payload.role};

    case 'LOGOUT':
      return {...state, isAuthenticated: false, userRole: 'user'};

    case 'LOAD_REPORT': {
      const { dateStr, type } = action.payload;
      const id = reportId(dateStr,type);
      const allReports = state.allReports || {};
      const baseData = computeContinuityBase(allReports,dateStr,type);
      baseData.id = id;

      // קבע “Previous” לצורך השוואה גרפית
      const prevCompare = computePreviousForCompare(allReports,dateStr,type);

      return {
        ...state,
        currentReportId: id,
        dataForEditing: JSON.parse(JSON.stringify(baseData)),
        liveData: calculateTotals(baseData),
        previousValues: prevCompare ? JSON.parse(JSON.stringify(prevCompare)) : {}
      };
    }

    case 'UPDATE_EDITING_FIELD': {
      if (state.userRole !== 'admin') return state;
      const { fieldPath, value } = action.payload;
      const newState = JSON.parse(JSON.stringify(state));
      let current = newState.dataForEditing;
      const path = fieldPath.split('.');
      for (let i=0;i<path.length-1;i++){
        if (!current[path[i]]) current[path[i]] = {};
        current = current[path[i]];
      }
      current[path[path.length-1]] = value;
      newState.liveData = calculateTotals(newState.dataForEditing);
      return newState;
    }

    case 'SAVE_DATA': {
      if (state.userRole !== 'admin' || !state.currentReportId) return state;
      const newAllReports = {...state.allReports, [state.currentReportId]: state.dataForEditing};
      // שמירה היברידית מיידית
      saveLocalReports(newAllReports);
      localStorage.setItem('sentinelLastSavedReportId', state.currentReportId);
      return {
        ...state,
        allReports: newAllReports,
        lastUpdateInfo: { time: new Date().toLocaleString('he-IL') }
      };
    }

    case 'RESET_TODAY_DATA': {
      if (state.userRole !== 'admin' || !state.currentReportId) return state;
      const fresh = JSON.parse(JSON.stringify(initialReportState));
      const newAllReports = {...state.allReports, [state.currentReportId]: fresh};
      saveLocalReports(newAllReports);
      return {
        ...state,
        allReports: newAllReports,
        dataForEditing: fresh,
        liveData: calculateTotals(fresh),
        lastUpdateInfo: { time: new Date().toLocaleString('he-IL') }
      };
    }

    case 'ADD_NOTIFICATION':
      if (state.notifications.some(n=>n.text===action.payload.text)) return state;
      return {...state, notifications: [action.payload, ...state.notifications]};

    case 'HYDRATE_FROM_IDB': {
      const merged = action.payload || {};
      const fromLocal = loadLocalReports();
      // local עדיף אם חדש יותר; לשם פשטות נעדיף local אם יש
      const final = Object.keys(fromLocal).length ? fromLocal : merged;
      saveLocalReports(final); // כתוב חזרה לשניהם
      return {
        ...state,
        allReports: final
      };
    }

    default: return state;
  }
}

/* =========================================================
   Provider
   ========================================================= */
const DashboardProvider = ({children})=>{
  const [state,dispatch] = useReducer(dashboardReducer, loadInitialState());

  // Hydrate from IDB on mount + persist request
  useEffect(()=>{
    (async ()=>{
      await persistIfPossible(); // יעזור בדפדפנים תומכים[2]
      const idb = await idbGet('sentinelReports');
      if (idb) {
        try {
          dispatch({type:'HYDRATE_FROM_IDB', payload: JSON.parse(idb)});
        } catch {}
      }
    })();
  },[]);

  // iOS/WebKit: sync on pagehide/visibilitychange כדי לא לאבד כתיבה
  useEffect(()=>{
    const sync = ()=>{
      const current = state.allReports || {};
      saveLocalReports(current);
    };
    window.addEventListener('pagehide', sync);
    document.addEventListener('visibilitychange', ()=>{
      if (document.visibilityState === 'hidden') sync();
    });
    return ()=>{
      window.removeEventListener('pagehide', sync);
      document.removeEventListener('visibilitychange', sync);
    };
  },[state.allReports]);

  return <DashboardContext.Provider value={{state,dispatch}}>{children}</DashboardContext.Provider>;
};

/* =========================================================
   שאר הקומפוננטות – שמירה על המבנה המקורי
   כולל תיקוני הלוגיקה/גרפים/RTL/תאריכים כמפורט
   ========================================================= */

/* ... Clock, SystemLogo, AnimatedNumber (unchanged UI) ... */

/* טופס כניסה (ללא שינוי פונקציונלי) */
/* ... LoginScreen as in your file ... */

/* Top bar, tabs וכו' (ללא שינוי מהותי) */
/* ... TopBar, TabNavigation, ControlPanelTabs ... */

/* =========================================================
   MainDashboard – תיקונים: ניתוב טעינה לפי כללים, מעבר תאריכים,
   והפעלת LOAD_REPORT עם date/type ולא previousData ידני
   ========================================================= */
const MainDashboard = ()=>{
  const {state,dispatch} = useContext(DashboardContext);
  const {userRole} = state;
  const {t} = useTranslation();

  const [reportDate,setReportDate] = useState(()=>{
    const lastId = localStorage.getItem('sentinelLastSavedReportId');
    if (lastId) {
      const parts = lastId.split('-');
      if (parts.length>=3) {
        const date = parts.slice(0,3).join('-');
        if (!isNaN(new Date(date).getTime())) return date;
      }
    }
    return dateToStr(new Date());
  });
  const [currentReportType,setCurrentReportType] = useState(()=>{
    const lastId = localStorage.getItem('sentinelLastSavedReportId');
    if (lastId) {
      const parts = lastId.split('-');
      if (parts.length>=4) return parts;[1]
    }
    return 'morning';
  });

  // LOAD_REPORT לפי כללי רציפות
  useEffect(()=>{
    dispatch({type:'LOAD_REPORT', payload:{dateStr:reportDate, type:currentReportType}});
  },[reportDate,currentReportType,dispatch]);

  const [message,setMessage] = useState({text:'',isError:false,visible:false});
  const [theme,setTheme] = useState('theme-dark');
  const [activeModal,setActiveModal] = useState(null);
  const [activeTab,setActiveTab] = useState('command_bridge');
  const [activeControlPanelTab,setActiveControlPanelTab] = useState('backup_restore');
  const [isAiGenerating,setIsAiGenerating] = useState(false);
  const infographicContainerRef = useRef(null);

  useEffect(()=>{
    try {
      const savedTheme = localStorage.getItem('sentinel-theme') || 'theme-dark';
      setTheme(savedTheme);
      document.documentElement.classList.add(savedTheme.replace('theme-',''));
      document.body.classList.add(savedTheme);
    } catch {}
  },[]);

  useEffect(()=>{
    document.title = t('app_title');
  },[t]);

  useEffect(()=>{
    let timer;
    if (message.visible){
      timer = setTimeout(()=>setMessage(p=>({...p,visible:false})),5000);
    }
    return ()=>clearTimeout(timer);
  },[message]);

  const showMessage = useCallback((text,isError=false)=>{
    setMessage({text,isError,visible:true});
  },[]);

  const toggleTheme = ()=>{
    try {
      const newTheme = theme==='theme-dark' ? 'theme-light' : 'theme-dark';
      const oldTheme = theme;
      setTheme(newTheme);
      localStorage.setItem('sentinel-theme', newTheme);
      document.documentElement.classList.remove(oldTheme.replace('theme-',''));
      document.body.classList.remove(oldTheme);
      document.documentElement.classList.add(newTheme.replace('theme-',''));
      document.body.classList.add(newTheme);
    } catch {}
  };

  const getFormattedFileName = (type)=>{
    const now = new Date();
    const date = now.toISOString().split('T');
    const time = now.toTimeString().split(' ').replace(/:/g,'-');
    return `Project-Sentinel-Command-Nexus-v24.1-${date}-${time}.${type}`;
  };

  const handleExport = async ()=>{
    const element = infographicContainerRef.current;
    if (!element) { showMessage("שגיאת ייצוא: לא נמצאה הפניה לאלמנט.",true); return; }
    showMessage("מכין ייצוא...");
    try {
      Chart.defaults.animation = false;
      const canvas = await html2canvas(element,{
        backgroundColor: document.body.classList.contains('theme-dark') ? '#0f172a' : '#f1f5f9',
        scale: 2,
        useCORS: true
      });
      Chart.defaults.animation = {};
      const fileName = getFormattedFileName('png');
      const link = document.createElement('a');
      link.href = canvas.toDataURL('image/png');
      link.download = fileName;
      link.click();
    } catch (e) {
      console.error("שגיאה בתהליך הייצוא:", e);
      showMessage("שגיאה ביצירת הקובץ.", true);
      Chart.defaults.animation = {};
    }
  };

  const handleDateChange = (days)=>{
    const d = new Date(reportDate);
    d.setDate(d.getDate()+days);
    setReportDate(dateToStr(d));
  };

  const handleShareLink = ()=>{
    const url = window.location.href;
    try {
      const textArea = document.createElement("textarea");
      textArea.value = url;
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();
      document.execCommand('copy');
      document.body.removeChild(textArea);
      showMessage("הקישור הועתק ללוח!");
    } catch {
      showMessage("שגיאה בהעתקת הקישור.",true);
    }
  };

  const {liveData,lastUpdateInfo,previousValues} = state;

  const handleSaveData = ()=>{
    dispatch({type:'SAVE_DATA'});
    showMessage(t('data_saved_success'));
    setIsAiGenerating(true);
  };
  const handleResetData = ()=>{
    dispatch({type:'RESET_TODAY_DATA'});
    showMessage(t('data_reset_success'));
  };

  if (!state.currentReportId) {
    return <div className="flex justify-center items-center min-h-screen"><div className="loading-spinner"></div></div>;
  }

  return (
    <div className="fade-in-on-load">
      {activeModal && <Modal activeModal={activeModal} setActiveModal={setActiveModal} onExport={handleExport} />}
      {/* ... Top buttons ... */}
      <div className="w-full max-w-6xl mx-auto p-4 md:p-6">
        <TopBar theme={theme} toggleTheme={toggleTheme} />
        {/* כותרת, בחירת תאריך/סוג דו"ח */}
        {/* ... same as your UI, using reportDate/currentReportType + setReportDate/setCurrentReportType ... */}

        {/* טעינת טאבים */}
        {/* ... TabNavigation ... */}

        <div className="pt-2.5">
          {/* Command Bridge */}
          <div style={{display: 'block' /* controlled by activeTab in original */}}>
            <>
              <KpiStrip />
              {/* DailyFocusAI וכו' */}
              <div ref={infographicContainerRef}>
                <div className="bg-[--bg-secondary] rounded-2xl border border-[--border-color] shadow-2xl p-6">
                  <DashboardHeader currentReportType={currentReportType} reportDate={reportDate} />
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
                    <div className="lg:col-span-2 space-y-5">
                      <div className="grid grid-cols-1 sm:grid-cols-2 gap-5">
                        <div id="card-overallStatus" className="fade-in-on-load" style={{animationDelay:"100ms"}}>
                          <SectionCard id="card-overallStatus" showMessage={showMessage} />
                        </div>
                        <div id="card-signedOrders" className="fade-in-on-load" style={{animationDelay:"200ms"}}>
                          <SectionCard id="card-signedOrders" showMessage={showMessage} />
                        </div>
                      </div>
                      <div className="grid grid-cols-1 sm:grid-cols-2 gap-5">
                        <div id="card-rejectedOrders" className="fade-in-on-load" style={{animationDelay:"400ms"}}>
                          <SectionCard id="card-rejectedOrders" showMessage={showMessage} />
                        </div>
                        <div id="card-pendingCorrection" className="fade-in-on-load" style={{animationDelay:"500ms"}}>
                          <SectionCard id="card-pendingCorrection" showMessage={showMessage} />
                        </div>
                      </div>
                      <div className="grid grid-cols-1 sm:grid-cols-2 gap-5">
                        <div id="card-pendingAncillaryForm" className="fade-in-on-load" style={{animationDelay:"600ms"}}>
                          <SectionCard id="card-pendingAncillaryForm" showMessage={showMessage} />
                        </div>
                        <div id="card-pendingAssetNumberEntry" className="fade-in-on-load" style={{animationDelay:"700ms"}}>
                          <SectionCard id="card-pendingAssetNumberEntry" showMessage={showMessage} />
                        </div>
                      </div>
                    </div>
                    <div className="flex flex-col space-y-5">
                      <div id="card-pendingSignature" className="fade-in-on-load" style={{animationDelay:"300ms"}}>
                        <SectionCard id="card-pendingSignature" showMessage={showMessage} />
                      </div>
                      {userRole==='admin' &&
                        <div className="p-4 bg-[--bg-primary] rounded-lg border border-[--border-color] flex flex-col gap-4 justify-center">
                          <button onClick={handleSaveData} className="w-full inline-flex items-center justify-center gap-2 rounded-lg text-sm font-semibold py-2.5 px-4 border bg-teal-600 border-teal-500 text-white hover:bg-teal-500">
                            <i className="fas fa-save"></i>{t('save_data')}
                          </button>
                          <button onClick={handleResetData} className="w-full inline-flex items-center justify-center gap-2 rounded-lg text-sm font-semibold py-2.5 px-4 border bg-red-600 border-red-500 text-white hover:bg-red-500">
                            <i className="fas fa-undo"></i>{t('reset_data')}
                          </button>
                        </div>}
                    </div>
                  </div>
                </div>
              </div>
            </>
          </div>

          {/* Intelligence HQ / Sharing / Control Panel blocks – unchanged structurally */}
        </div>
      </div>

      {message.visible &&
        <div className={`fixed top-5 left-1/2 -translate-x-1/2 px-6 py-3 rounded-lg shadow-lg text-white transition-all duration-500 ${message.isError ? 'bg-red-500':'bg-teal-500'}`}>
          {message.text}
        </div>}
    </div>
  );
};

/* =========================================================
   SectionCard – תיקון השוואה “לפני/אחרי” לגרפים
   ========================================================= */
const cardDefinitions = {
  overallStatus: { titleKey:'card_title_overallStatus', color:'teal', icon:'fa-tachometer-alt' },
  signedOrders: { titleKey:'card_title_signedOrders', color:'teal', icon:'fa-check-double' },
  pendingSignature: { titleKey:'card_title_pendingSignature', color:'purple', icon:'fa-signature' },
  rejectedOrders: { titleKey:'card_title_rejectedOrders', subtitleKey:'card_subtitle_rejectedOrders', color:'red', icon:'fa-times-circle' },
  pendingAncillaryForm: { titleKey:'card_title_pendingAncillaryForm', subtitleKey:'card_subtitle_pending

[1](https://stackoverflow.com/questions/57787209/safari-does-not-support-indexeddb-databases)
[2](https://rxdb.info/articles/indexeddb-max-storage-limit.html)
[3](https://github.com/dfahlander/Dexie.js/issues/739)
[4](https://www.reddit.com/r/webdev/comments/11qalm2/this_cant_seriously_be_how_apples_webkit_engine/)
[5](https://discussions.apple.com/thread/255772939)
[6](https://www.theregister.com/2022/01/21/apple_safari_webkit_indexeddb/)
[7](https://forum.ionicframework.com/t/indexeddb-in-latest-ios/210306)
[8](https://mosdia.com/blog/fix-web-fonts/)
[9](https://www.reddit.com/r/chrome/comments/hapcju/squares_appearing_instead_of_texts_and_emojis_fix/)
[10](https://forum.bubble.io/t/chart-js-can-not-display-date-as-label/112649)
[11](https://www.youtube.com/watch?v=Gc5JF2TUG7o)
[12](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/images/71936845/ac7e298f-b55b-4d71-a8c2-779d8a1be781/image.jpg?AWSAccessKeyId=ASIA2F3EMEYEWHUEMVBT&Signature=%2Bs4UW2RFFaPZvIao2nWFMFsvFHg%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEIb%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLWVhc3QtMSJHMEUCIQCBaApnIuBXXBf5roDsOdbcQXA2wgKNnLoHeThPnEFB0gIgam39tXeVWCcx03w9is6T8mESXlPn%2BUjqngo4usYMh2Aq%2BgQI7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARABGgw2OTk3NTMzMDk3MDUiDIrOEqjprd64BfKNNCrOBMWGo4GFwvaXj%2FmkIo7YyPjkW%2FUEGnl2nKPO4GBzvwS7TVyth8sdb1dNXtNCiH7agP1LpBPOP5XFclMbWEx1WibUgyJ35JLR0DvQxwHxlAxl1RNoia9YtlBPFJe2i8dNIRK%2BFbj5VcMNjhRQ0mkMGD%2B9ST7Ds3J52Yq%2BSSdM4OB%2F4O0%2Fb%2FaELl90cPSUFyoPYl166ws5WmANQwI4K9OeoBgBhUFjpxTtKlz%2FhPzUrNlSC6TS1AK70xZE7X4iEChzfrfTN7UwIRUPFX0RIIweNuvKkW%2Bwd3uM1m%2B5hpfM6YsV5fweMxmN7zDebNOzcdQnoeo4LDepo7Uzik3%2BItYTRXTu08H5xTx7Z1B87Ep5fzb8DvvmTDmr6oQsviulsc98ZOiJ%2BhRRXPyYWsYQ3Xrxqy5Hes4T0JSDmXkWRpVV3KXDw0fqKaNUJLvDoGz%2FEpMRrgfwVUHihdTjokcKjY9DPmk9rciacZhBezwSkNUWfJzqMy2POYN4%2BDc8%2FIzMpgtZmybViW9leiinJT%2BW2Xoh9WEXRr3tDswIRjhDMGXwnGpd0cD2GiOBAGU9Y1mEruTRcTa%2BcZYL3Cu0R%2ByJLPz%2BOgaamiDX7%2Basykj9eTgTotCeeQSfZMk0rsykOkH71WEH7J%2FBwdNZRqoW9rFZtfGShW3ONYTdyfs5Yv1fSIwgvNQkaLKg9SPEg7Gv1Bghesc8UkG7OjiWsX0OZK%2FZT2Zo%2FT7gXIqYQLDmMFAXo%2FuXX4RiD2u3xdhQU0F2qhXGsMBM6ZFa3%2Byi5tIy4NoeVyaXMML%2FhcYGOpoBOJ8CyrhwHvDAx403OPC5H9M8fEWtGDsHVS7CZmhtdP5vocuoSa17ntUiCFVatWrIJOjx9avpnqUsWlR16LvaEDJRgy8IvfweuqWZNc7wP2KqHYyiWc1VaDx37L2WzWW13J32rph%2F8tRHFADQBLDXYqLE%2BQ3OkMpEq62hUIICGQdDUaqKVWTbEsl445o48xTfh6W73RYJt%2B0QYQ%3D%3D&Expires=1757514286)
[13](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/71936845/11d8907d-2641-42ee-a4ec-1d644ef913cf/paste-2.txt)
[14](https://developer.mozilla.org/en-US/docs/Web/CSS/font-variant-emoji)
[15](https://stackoverflow.com/questions/79076985/dataset-scaling-in-a-chart-js-bar-chart-for-better-comparison)
[16](https://community.wappler.io/t/local-storage-not-working-on-ios-both-chrome-and-safari/40964)
[17](https://stackoverflow.com/questions/62102543/prevent-font-rendering-as-an-emoji)
[18](https://www.chartjs.org/docs/latest/general/performance.html)
[19](https://news.ycombinator.com/item?id=27509206)
[20](https://github.com/web-platform-tests/interop/issues/569)
[21](https://www.chartjs.org/docs/latest/axes/cartesian/time.html)
[22](https://www.reddit.com/r/webdev/comments/t59a99/how_can_i_prevent_a_unicode_character_from/)